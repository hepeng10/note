## 模态框的显示隐藏
```tsx
<View>
  <!-- 轮播 -->
  <Slider />
  <!-- 商品组 -->
  <Goods />
  <!-- 模态弹窗 -->
  {isShowModal && <Modal />}
</View>
```
当 isShowModal 由 true 变为 false 时，模态弹窗会从显示变为消失。此时 Modal 组件的兄弟节点都会被更新，setData 的数据是 Slider + Goods 组件的 DOM 节点信息。

**解决办法**
```tsx
<View>
  <!-- 轮播 -->
  <Slider />
  <!-- 商品组 -->
  <Goods />
  <!-- 模态弹窗 -->
  <View>
    {isShowModal && <Modal />}
  </View>
</View>
```
可以通过将模态框放到独立的 View 中，就可以避免兄弟组件被更新了。

## 组件的属性应尽量使用引用
```tsx
<Map
  latitude={22.53332}
  longitude={113.93041}
  markers={[{  // 这里每次渲染都会是新的数组
    latitude: 22.53332,
    longitude: 113.93041
  }]}
/>
```
**解决办法**
```tsx
<Map
  latitude={22.53332}
  longitude={113.93041}
  markers={this.state.markers}  // 使用引用避免重复渲染
/>
```

## 滚动穿透
在小程序开发中，滑动蒙层、弹窗等覆盖式元素时，滑动事件会冒泡到页面，使页面元素也跟着滑动。
**解决办法**
1. 给需要禁用滚动的组件写一个样式，类似于：
```tsx
{
  overflow：hidden;
  height: 100vh;
}
```
2. 添加 catchMove 属性
```tsx
// 这个 View 组件会绑定 catchtouchmove 事件而不是 bindtouchmove
<View catchMove />
```

## 跳转预加载
可以在页面跳转之前就开始下个页面的网络请求等。
跳转前的页面：
```tsx
// pages/index.js
Taro.preload(fetchSomething())  // 使用 preload 进行提前请求
Taro.navigateTo({ url: '/pages/detail' })
```
跳转后的页面：
```tsx
// pages/detail.js
console.log(getCurrentInstance().preloadData)  // 获取 preload 请求到的数据
```

## 保存 Taro.getCurrentInstance()
开发中我们常常会调用 Taro.getCurrentInstance() 获取小程序的 app、page 对象、路由参数等数据。但频繁调用它可能会导致问题。因此推荐把 Taro.getCurrentInstance() 的结果在组件中保存起来，之后直接使用：
```tsx
class Index extends React.Component {
  inst = Taro.getCurrentInstance()

  componentDidMount () {
    console.log(this.inst)
  }
}
```

## 长列表优化
使用 VirtualList 虚拟列表组件，虚拟列表只会渲染可视区域内的组件，非可视区域的组件在用户滚动到可视区域再渲染。[点击详细了解](https://nervjs.github.io/taro/docs/next/virtual-list)
```tsx
import VirtualList from `@tarojs/components/virtual-list`

function buildData (offset = 0) {
  return Array(100).fill(0).map((_, i) => i + offset);
}

const Row = React.memo(({ id, index, style, data }) => {
  return (
    <View id={id} className={index % 2 ? 'ListItemOdd' : 'ListItemEven'} style={style}>
      Row {index} : {data[index]}
    </View>
  );
})

export default class Index extends Component {
  state = {
    data: buildData(0),
  }

  render() {
    const { data } = this.state
    const dataLen = data.length
    return (
      <VirtualList
        height={500} /* 列表的高度 */
        width='100%' /* 列表的宽度 */
        itemData={data} /* 渲染列表的数据 */
        itemCount={dataLen} /*  渲染列表的长度 */
        itemSize={100} /* 列表单项的高度  */
      >
        {Row} /* 列表单项组件，这里只能传入一个组件 */
      </VirtualList>
    );
  }
}
```