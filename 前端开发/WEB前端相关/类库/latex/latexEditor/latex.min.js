
(function anonymous() {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src = "jquery.min.js";
    document.getElementsByTagName("head")[0].appendChild(script);
    let isMathjaxConfig = false;
    window.MathJax = {
        "HTML-CSS": {
            showMathMenu: false,
        },
    };
    (function () {
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "MathJax.js?config=TeX-AMS-MML_HTMLorMML";
        document.getElementsByTagName("head")[0].appendChild(script);
        var script = document.createElement("script");
        script.type = "text/javascript";
        script.src = "katex.min.js";
        document.getElementsByTagName("head")[0].appendChild(script);
    }
    )();
    setTimeout(function () {
        var linkCSS = document.createElement("link");
        linkCSS.rel = "stylesheet";
        linkCSS.href = "katex.min.css";
        document.head.insertBefore(linkCSS, document.head.childNodes[document.head.childNodes.length - 1].nextSibling);
    }, 1500);
}
)();
function createXMLHTTPObject() {
    var XMLHttpFactories = [function () {
        return new XMLHttpRequest()
    }
        , function () {
            return new ActiveXObject("Msxml2.XMLHTTP")
        }
        , function () {
            return new ActiveXObject("Msxml3.XMLHTTP")
        }
        , function () {
            return new ActiveXObject("Microsoft.XMLHTTP")
        }
        ,];
    var xmlhttp = false;
    for (var i = 0; i < XMLHttpFactories.length; i++) {
        try {
            xmlhttp = XMLHttpFactories[i]();
        } catch (e) {
            continue;
        }
        break;
    }
    return xmlhttp;
}
function syncRequest(url, callback) {
    var xmlHttp = createXMLHTTPObject();
    xmlHttp.open("GET", url, false);
    xmlHttp.send(null);
    callback(xmlHttp);
}


function asyncRequest(url, callback, data) {
    var xmlHttp = createXMLHTTPObject();
    if (!xmlHttp) {
        return;
    }
    var method = (data) ? "POST" : "GET";
    xmlHttp.open(method, url, true);
    if (data) {
        xmlHttp.setRequestHeader('Content-type', 'application/x-www-form-urlencoded');
    }
    xmlHttp.onreadystatechange = function () {
        if (xmlHttp.readyState != 4) {
            return;
        }
        if (xmlHttp.status != 200 && xmlHttp.status != 304) {
            alert('HTTP请求错误' + xmlHttp.status);
            return;
        }
        callback(xmlHttp);
    }
        ;
    if (xmlHttp.readyState == 4) {
        return;
    }
    xmlHttp.send(data);
}

function latexToURI(latex) {
    var URI = window.encodeURIComponent(latex);
    var URI = window.btoa(URI);
    return URI;
}
function ToKatex(latex) {
    try {
        var LatexHTML = katex.renderToString(latex, {
            displayMode: true,
        });
    } catch (e) {
        var LatexHTML = "未显示";
    }
    return LatexHTML;
}

function getId(n) {
    return document.getElementById(n);
}
var nocookies = false;
var Cookie = {
    set: function (c_name, value, expiredays) {
        if (nocookies)
            return;
        {
            var exdate = new Date();
            exdate.setDate(exdate.getDate() + expiredays);
            document.cookie = c_name + "=" + escape(value) + ((expiredays == null) ? "" : ";expires=" + exdate.toGMTString());
        }
    },
    get: function (c_name) {
        if (document.cookie.length > 0) {
            c_start = document.cookie.indexOf(c_name + "=");
            if (c_start != -1) {
                c_start = c_start + c_name.length + 1;
                c_end = document.cookie.indexOf(";", c_start);
                if (c_end == -1) {
                    c_end = document.cookie.length;
                }
                return unescape(document.cookie.substring(c_start, c_end));
            }
        }
        return '';
    }
};
var Panel = {
    timer: Array(),
    open: function (a) {
        if (a) {
            var id = a.id;
            if (this.timer[id] != '') {
                clearTimeout(this.timer[id]);
                this.timer[id] = '';
            }
            this.timer[id] = setTimeout("getId('" + id + "').style.overflow='visible';", 200);
        }
    },
    close: function (a) {
        if (a) {
            var id = a.id;
            if (this.timer[id] != '') {
                clearTimeout(this.timer[id]);
                this.timer[id] = '';
            }
            this.timer[id] = setTimeout("getId('" + id + "').style.overflow='hidden';", 200);
        }
    },
    init: function (hoverbox, editorid) {
        this.hoverdiv = getId(hoverbox);
        var divElem;
        if (editorid !== undefined) {
            divElem = document.getElementById(editorid);
        } else {
            divElem = document;
        }
        var areas = divElem.getElementsByTagName('area');
        for (i = 0; i < areas.length; i++) {
            latex = areas[i].alt;
            areas[i].latex = latex;
            areas[i].alt = '';
            if (areas[i].title == '')
                areas[i].title = latex;
            if (areas[i].onclick == undefined) {
                areas[i].onclick = function () {
                    EqEditor.insert(this.latex);
                }
                    ;
            }
        }
        if (divElem.getElementsByClassName == undefined) {
            divElem.getElementsByClassName = function (className) {
                var hasClassName = new RegExp("(?:^|\\s)" + className + "(?:$|\\s)");
                var allElements = divElem.getElementsByTagName("*");
                var results = [];
                var element;
                for (var i = 0; (element = allElements[i]) != null; i++) {
                    var elementClass = element.className;
                    if (elementClass && elementClass.indexOf(className) != -1 && hasClassName.test(elementClass)) {
                        results.push(element);
                    }
                }
                return results;
            }
        }
        var panels = divElem.getElementsByClassName('panel');
        for (i = 0; i < panels.length; i++) {
            if (panels[i].id != '') {
                panels[i].onmouseover = function (e) {
                    Panel.open(this);
                }
                    ;
                panels[i].onmouseout = function (e) {
                    Panel.close(this);
                }
                    ;
            }
        }
    }
};
function EqTextArea(preview, input, comment, download, intro) {
    this.myUndo = 0;
    this.myRedo = 0;
    this.store_text = new Array();
    this.store_text.push("");
    this.set = function (preview, input, comment, download, intro) {
        if (input == undefined || input == '') {
            input = 'latex_formula';
        }
        this.equation_input = getId(input);
    }
        ;
    this.clearText = function () {
        this.equation_input.value = "";
        this.equation_input.focus();
        getId('clearText').style.background = "#FF6666";
    }
        ;
    this.insertText = function (txt, pos, inspos) {
        if (pos == 1000) {
            pos = txt.length - 1;
        }
        if (pos == null) {
            pos = txt.indexOf('{') + 1;
            if (pos <= 0) {
                txt += ' ';
                pos = txt.length;
            } else {
                if (txt.charAt(pos) != '}') {
                    pos = txt.indexOf('}', pos) + 1;
                }
            }
        }
        var insert_pos = (inspos == null) ? pos : inspos;
        var i;
        var myField = this.equation_input;
        var leftbracket = (txt.substring(1, 5) == "left");
        if (document.selection) {
            myField.focus();
            var sel = document.selection.createRange();
            i = this.equation_input.value.length + 1;
            var theCaret = sel.duplicate();
            while (theCaret.parentElement() == myField && theCaret.move("character", 1) == 1) {
                --i;
            }
            if ((leftbracket || insert_pos >= 0) && sel.text.length) {
                if (leftbracket) {
                    ins_point = 7;
                } else {
                    ins_point = insert_pos;
                }
                if (insert_pos == null) {
                    pos = txt.length + sel.text.length + 1;
                } else {
                    if (insert_pos < pos) {
                        pos += sel.text.length;
                    }
                }
                sel.text = txt.substring(0, ins_point) + sel.text + txt.substr(ins_point);
            } else {
                sel.text = txt;
            }
            var range = myField.createTextRange();
            range.collapse(true);
            pos = i + pos;
            pos -= myField.value.substr(0, pos).split("\n").length - 1;
            range.moveEnd('character', pos);
            range.moveStart('character', pos);
            range.select();
        } else {
            if (myField.selectionStart || myField.selectionStart == '0') {
                var startPos = myField.selectionStart;
                var endPos = myField.selectionEnd;
                var cursorPos = startPos + txt.length;
                if ((leftbracket || insert_pos >= 0) && endPos > startPos) {
                    if (leftbracket) {
                        ins_point = 7;
                    } else {
                        ins_point = insert_pos;
                    }
                    if (insert_pos == null) {
                        pos = txt.length + endPos - startPos + 1;
                    } else {
                        if (insert_pos < pos) {
                            pos += endPos - startPos;
                        }
                    }
                    txt = txt.substring(0, ins_point) + myField.value.substring(startPos, endPos) + txt.substr(ins_point);
                }
                myField.value = myField.value.substring(0, startPos) + txt + myField.value.substring(endPos, myField.value.length);
                myField.selectionStart = cursorPos;
                myField.selectionEnd = cursorPos;
                myField.focus();
                myField.setSelectionRange(startPos + pos, startPos + pos);  // 通过 textarea 的 setSelectionRange API 修改焦点位置
            } else {
                myField.value += txt;
            }
        }
        myField.focus();
    }
        ;
    this.clickval = 0;
    this.countclick = function () {
        var x = this.equation_input.value;
        this.clickval++;
        if (this.clickval >= 3) {
            this.clickval = 0;
            if (this.myUndo == 0 || this.store_text[this.myUndo] != x) {
                if (this.myUndo > 20) {
                    this.store_text.shift();
                } else {
                    this.myUndo++;
                }
                this.store_text[this.myUndo] = x;
            }
        }
        this.myRedo = 0;
    }
        ;
    this.undo = function (box) {
        if (this.myRedo == 0) {
            if (this.myUndo > 20) {
                this.store_text.shift();
            } else {
                this.myUndo++;
            }
            this.store_text[this.myUndo] = this.equation_input.value;
        }
        if (this.myRedo < this.myUndo) {
            this.myRedo++;
            if (this.myRedo == this.myUndo && getId('undo')) {
                getId('undo').style.background = "#FF6666";
            }
            var a = getId('redo');
            if (a) {
                a.style.background = "#777";
            }
        } else {
            return;
        }
        z = this.store_text.length - this.myRedo - 1;
        if (this.store_text[z]) {
            this.equation_input.value = this.store_text[z];
        } else {
            this.equation_input.value = this.store_text[0];
        }
        this.equation_input.focus();
    }
        ;
    this.redo = function (box) {
        if (this.myRedo > 0) {
            this.myRedo--;
            if (this.myRedo == 0 && getId('redo')) {
                getId('redo').style.background = "#FF6666";
            }
            var a = getId('undo');
            if (a) {
                a.style.background = "#777";
            }
        } else {
            return;
        }
        var z = this.store_text.length - this.myRedo - 1;
        if (this.store_text[z]) {
            this.equation_input.value = this.store_text[z];
        } else {
            this.equation_input.value = this.store_text[0];
        }
        this.equation_input.focus();
    }
        ;
    if (preview !== undefined) {
        this.set(preview, input, comment, download, intro);
    }
}
; var EqEditor = {
    targetArea: null,
    init: function (SID, obj, resize, editorid) {
        Panel.init('hover', editorid);
        if (obj !== undefined) {
            this.targetArea = obj;
        }
    },
    insert: function (txt, pos, inspos) {
        if (this.targetArea != null) {
            this.targetArea.insertText(txt, pos, inspos);
        }
    },
    undo: function () {
        this.targetArea.undo();
    },
    redo: function () {
        this.targetArea.redo();
    },
    clearText: function () {
        this.targetArea.clearText();
    },
    makeEquationsMatrix: function (type, isNumbered, isConditional) {
        if (isNumbered === undefined) {
            isNumbered = false;
        }
        if (isConditional === undefined) {
            isNumbered = false;
        }
        eqns = "\\begin{" + type + ((isNumbered) ? "" : "*") + "}";
        eqi = "\n &" + ((isNumbered) ? " " : "= ") + ((isConditional) ? "\\text{if}x= " : "");
        eqEnd = "\n\\end{" + type + ((isNumbered) ? "" : "*") + "}";
        i = 0;
        dim = prompt('输入行数（举例：3行，输入“3”）：', '3');
        if (dim != '' && dim !== null) {
            n = parseInt(dim);
            if (!isNaN(n)) {
                for (i = 1; i <= n - 1; i++) {
                    eqns = eqns + (eqi + "\\\\ ");
                }
                eqns = (eqns + eqi) + eqEnd;
                this.insert(eqns, type.length + ((isNumbered) ? 0 : 1) + 9);
            }
        }
    },
    makeArrayMatrix: function (type, start, end) {
        var matr = start + '\\begin{' + type + 'matrix}';
        var row = "\n";
        var mend = "\n\\end{" + type + "matrix}" + end;
        var i = 0;
        var dim = prompt('输入数组，以(英文)逗号分隔（举例：2行3列，输入“2,3”）', '2,3');
        if (dim !== '' && dim !== null) {
            dim = dim.split(',');
            m = parseInt(dim[0]);
            n = parseInt(dim[1]);
            if (!isNaN(m) && !isNaN(n)) {
                for (i = 2; i <= n; i++) {
                    row = row + ' & ';
                }
                for (i = 1; i <= m - 1; i++) {
                    matr = matr + row + '\\\\ ';
                }
                matr = matr + row + mend;
                this.insert(matr, type.length + start.length + 15);
            }
        }
    },
};
if (window.location.search) {
    //var urlcode = window.location.search;
    //document.getElementById("URLOutput").value = "https:/" + "/latex.91maths.com/s/" + urlcode;
    //document.getElementById("toFormula").href = "https:/" + "/latex.91maths.com/g/" + urlcode;
    //document.getElementById("toPic").href = "https:/" + "/latex.91maths.com/p/" + urlcode;
}
setTimeout(function () {
    var QUEUE = MathJax.Hub.queue;
    var math = null
        , box = null;
    var HIDEBOX = function () {
        box.style.visibility = "hidden"
    };
    var SHOWBOX = function () {
        box.style.visibility = "visible"
    };
    QUEUE.Push(function () {
        math = MathJax.Hub.getAllJax("MathOutput")[0];
        box = document.getElementById("box");
        SHOWBOX();
    });
    window.UpdateMath = function (TeX) {
        QUEUE.Push(HIDEBOX, ["resetEquationNumbers", MathJax.InputJax.TeX], ["Text", math, "\\displaystyle{" + TeX + "}"], SHOWBOX);
        var urlcode = window.encodeURIComponent(TeX);
        var urlcode = window.btoa(urlcode);
        //document.getElementById("URLOutput").value = "https:/" + "/latex.91maths.com/s/?" + urlcode;
        //document.getElementById("toFormula").href = "https:/" + "/latex.91maths.com/g/?" + urlcode;
        //document.getElementById("toPic").href = "https:/" + "/latex.91maths.com/p/?" + urlcode;
    }
        ;
    if (MathJax.Hub.Browser.isMSIE) {
        latex_formula.onkeypress = function () {
            if (window.event && window.event.keyCode === 13) {
                this.blur();
                this.focus()
            }
        }
    }
}, 500);
function toPicture() {
    obj = document.getElementById("latex_formula").value;
    if (obj == undefined || obj == "") {
        alert("请先输入Latex公式代码并敲击键盘Enter键");
        document.getElementById("toPic").href = "javascript:;";
        document.getElementById("toFormula").href = "javascript:;";
    }
}

var a = new EqTextArea('');
EqEditor.init('Common', a, true);
function show(obj, obj2) {
    var obj = document.getElementById(obj);
    var obj2 = document.getElementById(obj2);
    var objDisplay = obj.style.display;
    if (objDisplay == "none") {
        obj.style.display = "block";
        obj2.style.marginLeft = "160px";
        document.getElementById("openClose").innerHTML = "关闭推荐";
    } else {
        obj.style.display = "none";
        obj2.style.marginLeft = "0px";
        document.getElementById("openClose").innerHTML = "打开推荐";
    }
}
function copyText(obj, success, error) {
    obj = document.getElementById(obj);
    if (obj.value == undefined || obj.value == "") {
        alert(error);
    } else {
        obj.select();
        document.execCommand("copy");
        alert(success);
    }
}
var sideTitle = "<div id='sidetitle' style='width:37px;height:200px;position:relative;top:-161px;left:45px;background:#777;color:#fff;font-size:16px;letter-spacing:2px;text-shadow:-4px 4px 1px #222;box-shadow:6px 6px 6px #222;animation:shake 0.8s linear;float:right;'><div style='width:18px;height:182px;position:relative;top:9px;left:11px;line-height:18px;'>吴文中数学公式编辑器</div><div style='width:28px;height:32px;font-size:11px;position:relative;left:41px;top:-144px;background:#777;padding:2px 3px 5px 6px;cursor:pointer;' onclick='openTitle()'>返回顶部</div></div>";
setTimeout(function () {
    var st, top3;
    $(window).scroll(function () {
        st = Math.max(document.body.scrollTop || document.documentElement.scrollTop);
        if (st > 80 & $("#sidetitle").length == 0) {
            $("#example").after(sideTitle);
        } else if (st < 80) {
            $("#sidetitle").remove();
        }
        if ($(".title").is(":hidden") & $("#sidetitle").length == 0) {
            $("#example").after(sideTitle);
        }
        if (st > 440 & $("#sidetitle").length > 0) {
            $("#sidetitle").css({
                top: '205px'
            });
        } else if (st > 270 & $("#sidetitle").length > 0) {
            $("#sidetitle").css({
                top: '18px'
            });
        }
    });
    $.fn.extend({
        txtaAutoHeight: function () {
            return this.each(function () {
                var $this = $(this);
                if (!$this.attr('initAttrH')) {
                    $this.attr('initAttrH', $this.outerHeight());
                }
                setAutoHeight(this).on('input', function () {
                    setAutoHeight(this);
                });
            });
            function setAutoHeight(elem) {
                var $obj = $(elem);
                return $obj.css({
                    height: $obj.attr('initAttrH'),
                    'overflow-y': 'hidden'
                }).height(elem.scrollHeight);
            }
        }
    });
    // $("#latex_formula").txtaAutoHeight();
    //$(".book").html("<img src='//oss.91maths.com/cal_book.png' width='160' height='630' alt='AP微积分辅导手册'>");
}, 1000);
function closeTitle() {
    $(".title").hide();
    $("#example").after(sideTitle);
    $("#center").css({
        "margin-top": "70px",
    });
}
function openTitle() {
    $(".title").show();
    $(window).scrollTop(0);
    $("#sidetitle").remove();
    $("#center").css({
        "margin-top": "90px",
    });
}
var guideSwitch = window.location.hash;
