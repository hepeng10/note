# vi 的三种模式
vi 编辑器分为三种工作模式：命令模式、编辑模式、底行模式。

**要点：无论处于那种工作模式，按 Esc键 都可进入命令模式。编辑模式和底行模式的切换，必须要经过命令模式。**

* 命令模式：刚进入vi 时的默认模式。这个模式下能够进行：移动光标、整行的复制粘贴、整行删除 等基本操作。
* 编辑模式：在命令模式下，按 "a" "i" "o" 均可进入编辑模式。此模式下能够进行：文本的输入、删除。
* 底行模式：在命令模式下，按 ":" "/" "?" 均可进入底行模式。由于此模式的输入会显示在窗口的最后一行，也叫末行模式。此模式下能够进行：搜索、保存、离开 等操作。

### 编辑模式
在命令模式下使用 i|a|o  都能进入插入模式，不同之处在于是在光标的哪个位置插入。
i 在光标前插入
a 在光标后插入，光标会往后移动一位。比如我们要在一行的末尾加个分号，如果用 i 就需要按下右再输入分号，用 a 就可以直接输入了
o 光标下插入新行。快速插入行操作
I 光标移到行首插入。
A 光标移到行尾插入。
O 光标上插入新行。

### 底行模式
使用 : 进入底行模式

:!command 在 vi 中执行外部命令。如：`:!pwd` 就会显示当前所在路径。 

:set nu  // 设置行号
:set nonu  // 取消行号
:123  // 到 123 行
:10,18y  // 复制10到18行
:10,18d  // 删除10到18行
:w  // 保存修改
:w /root/another.txt  // 另存为 another.txt
:wq  // 保存退出
:q!  // 不保存强制退出
:wq!  //  强制保存退出，对于没有写权限的文件使用。当然，只有 root 和文件所有者用
:x  // 等价 :wq

:set ic  // 进入不区分大小写的搜索模式
:set noic  // 进入区分大小写的搜索模式
:set nu  // 显示行号
:set nonu // 隐藏行号
/xxxx  // 搜索 xxxx 字符，按 n 继续往下搜索，按 N 往上搜索

字符串替换：
:[范围]s/[oldStr]/[newStr]/[选项]  // 基本语法
:s/str1/str2  // 将当前行 str1 替换为 str2（没有指定范围默认当前行，没有选项只替换一次）
:%s/xxx/yyy/g  // 全文替换（%表示全文范围），将 xxx 替换为 yyy。g 表示直接替换，可以改为 c，在每个替换的时候会询问

### 命令模式
按 ESC 进入命令模式

yy  // 复制当前行
y0  // 复制光标到行首
y$  // 复制光标到行尾
nyy  // 复制当前行以下 n 行
p|P  // 粘贴在当前光标所在行下|上
r  // 修改模式，替换当前光标处字符
R  // 持续修改模式
u  // 取消上一步操作
^|0  // 光标移动到行首
$  // 光标移动到行尾
x  // 删除光标所在处字符
nx  // 删除光标所在后 n 个字符
D  // 删除光标所在处到行尾内容
dd  // 删除（剪切）光标所在行
d0  // 删除光标到行首
d$  // 删除光标到行尾
ndd  // 删除（剪切）光标所在行后 n 行字符
dG  // 删除光标所在行到文件末尾的内容
gg  // 光标跳到第一行
G  // 光标跳到最后一行
ZZ  // 等价 :wq

键盘光标命令：
h 左移一位
j 下移一行
k 上移一行
l 右移一位
1G 到文件首位
G 到文件末位

**vi 中通常 y 表示复制，d 表示删除，0表示头部，$表示尾部。所以上面的命令中某些可以灵活替换，如 :10,\$d 就表示从第10行删除到末尾。**